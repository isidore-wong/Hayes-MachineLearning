### 数据预处理
数据预处理是数据分析的重要基础，决定了后续分析的质量与价值；数据预处理主要包括数据清洗、转换、归约、聚合、抽样等。本篇先记录数据清洗的过程。

### 数据清洗
在数据清洗的过程中，主要是对缺失值、异常值和重复值进行处理；对其采用丢弃、填充、替换、去重等一系列操作，达到去除异常值，修改错误值、补全缺失值的目的。

---
#### 1.缺失值的处理
数据缺失分为行记录的缺失(数据记录丢失)和数据列值的缺失。丢失的数据记录无法找回，通常对于缺失值的处理，基本都是处理数据列缺失的情况。常用的处理方法有：
1. **丢弃**：直接删除整行或整列的数据，但丢弃就意味着会消减数据特征。出现以下情况不可采用该方法：
- 数据集总体中存在大量的数据记录不完整的情况且比例较大，例如超过10%，删除将会损失过多有用的信息
- 带有缺失值的数据记录大量存在着明显的数据分布规律或者特征，如果删除将会丢失大量特征信息，导致过拟合或者分类不准确
- 
2. **补全**：作为最常用的缺失值处理的方式，通过一定方法将数据补全，从而形成完整的数据记录，常用的方法有：
- 统计法：对于数值型数据，通常使用均值、加权均值、中位数等方法补足，对于分类型数据，使用类别众数最多的值补足
- 模型法：大多数情况下我们会基于已有的字段，将缺失值作为目标变量进行预判，从而得到最可能的不全值。数值型的采用回归模型补全，分类型采用分类模型补全
- 专家补全：对于少量且具有重要意义的数据记录，也可以采用专家补足
- 其他方法：例如随机森林、特殊值法、多重填补等

3. **真值转换法**：
- 在某些情况下无法得到缺失值的分布规律，且无法对缺失值采用以上方法补全；或认为缺失值也是一种规律，不应对缺失值随意处理，将会采用真值转换
- 本思路的观点是承认缺失值的存在，并把数据缺失也作为数据分布规律的一部分，将变量的实际值与缺失值都作为输入维度参与后续的数据处理与模型计算中。但实际值可以作为变量值参与模型计算，而缺失值则无法参与运算，故需对缺失值进行真值转换。
~~~~
例如以用户性别字段为例，许多数据库无法对性别进行补足，但又不舍得丢弃，那可以选择将其中的性别值从一个变量多个值的分布状态转换为多个变量的真值分布状态，将其作为新的字段参与到模型计算中
转换前：性别(男、女、未知)
转换后：性别_男(1或0)、性别_女(1或0)、性别_未知(1或0)
~~~~
4. **不处理**：对缺失值不做任何处理，主要看后期数据分析和建模应用，因为很多模型对缺失值有容忍度或灵活处理的方法，因此在预处理阶段不处理 ，常见的能自动处理缺失值的模型有KNN、决策树和随机森林、神经网络和朴素贝叶斯、DBSCAN(基于密度的带有噪音的空间聚类)等。这些模型对缺失值的处理思路是：
- 忽略：缺失值不参与距离计算，如KNN
- 将缺失值作为分布的一种状态：并参与到建模过程中，如决策树及其变体
- 不基于距离哦继续智能，因此基于值的距离做计算本身的影响就消除了，例如DBSCAN

##### 缺失值处理的思路
~~~~
1、采用一定的方法找到缺失值
2、分析缺失值在整体样本中的分布占比
3、分析缺失值是否具有显著的无规律分布特征
4、考虑后续的模型是否能满足缺失值的自动处理
5、决定采用哪种缺失值处理方法
~~~~

#### 2.异常数据的处理
异常数据是处于特定分布区域或范围之外的数据，通常被称为噪音，产生的原因：业务操作异常、数据采集问题、数据同步问题。数据异常需要判定是真异常还是伪异常
- 伪异常：是由于业务特定运营动作产生的，是真实反映业务状态，而不是数据本身的异常规律
- 真异常：该异常并不是由于特定的业务动作引起的，而是客观发硬数据本身分布异常的分布个案

**异常值的确定**常采用Z-Score标准化作为阈值--判断标准，标准化的得分超出阈值则为异常

**如何判断异常值**：有固定业务的直接套用业务规则，没有固定业务规则的采用数学模型进行判断
- 基于概率分布的模型：正太分布的标准差范围
- 基于聚类的方法：KMeans
- 基于密度的方法：LOF
- 基于分类的方法：KNN
- 基于统计的方法：分位数法

**无需**对异常值进行抛弃**处理**的情况：
1. 异常检测模型：比如信用卡欺诈、贷款审批、药物变质、流量作弊等
2. 反映业务真是的运营结果：比如活动促销等
3. 包容异常值的数据建模：模型对异常值不敏感，不处理也不会对模型产生影响，比如决策树会将异常作为一个分裂节点

#### 3.重复值处理--去重
数据值重复常见的情况：
1. 数据值完全相同的多条数据记录
2. 数据主体相同但匹配到的唯一属性值不同，常见于数据仓库中的变化维度表，同一事实表的主体会匹配同一个属性的多个值

##### 无需去重的情况
1. 重复的记录用于分析演变规律
2. 重复的记录用于样本不均衡的处理，对小样本做过采样处理，会出现重复的记录
3. 重复的记录用于检测业务规则问题，比如重复的订单、重复的充值等
---

### 数据转换
- 将分类数据(性别-男女)和顺序数据(学历-博士硕士学士)进行相关的转换
- 将该类非数值型数据处理成数值型数据，做标志转换(能够准确还原原数据中不同类别信息的信息差异和相互关联性)，处理后应用至模型中


[数据清洗代码](https://github.com/isidore-wong/MachineLearning-Algorithm/blob/master/00_DataProcessing%26FeatureEngineering/code/01_DataClean.ipynb)